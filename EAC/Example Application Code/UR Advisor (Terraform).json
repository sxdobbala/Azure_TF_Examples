{"source":2,"id":3,"revision":63,"name":"UR Advisor (Terraform)","description":null,"createdBy":{"id":"7bcd21e1-51fa-4c24-8c4e-9a734be6d82f","displayName":"mhedber","uniqueName":"MS\\mhedber","url":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_apis/Identities/7bcd21e1-51fa-4c24-8c4e-9a734be6d82f","imageUrl":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_api/_common/identityImage?id=7bcd21e1-51fa-4c24-8c4e-9a734be6d82f"},"createdOn":"2018-05-23T18:53:50.190Z","modifiedBy":{"id":"ec62238c-f9e4-4885-ae0d-6d2091875ffb","displayName":"bxudaybe","uniqueName":"MS\\bxudaybe","url":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_apis/Identities/ec62238c-f9e4-4885-ae0d-6d2091875ffb","imageUrl":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_api/_common/identityImage?id=ec62238c-f9e4-4885-ae0d-6d2091875ffb"},"modifiedOn":"2018-09-26T19:29:48.640Z","lastRelease":null,"path":"\\","variables":{"TF_WORKSPACE":{"value":"$(Release.EnvironmentName)"},"TF_CLI_ARGS":{"value":"-no-color"},"TF_VAR_PROJECT_NAME":{"value":"uradvisor"},"TF_VAR_USE_TEMPORARY_DATABASE":{"value":"false"},"LocalTerraformWorkspace":{"value":"C:\\TerraformWorkspace\\$(Release.EnvironmentName)\\$(TF_VAR_PROJECT_NAME)\\"},"DeploymentScriptSource":{"value":"$(System.DefaultWorkingDirectory)/UR Advisor/SolutionItems/CloudDeployment"},"TF_VAR_SQL_LOGIN":{"value":"uradvisor"},"TF_VAR_SQL_PASSWORD":{"value":null,"isSecret":true},"BuildAgent":{"value":"PAVSSB01"},"TF_VAR_ENVIRONMENT":{"value":"$(Release.EnvironmentName)"},"project_name":{"value":"UR Advisor"},"TF_VAR_OPTUMID_CLIENTSECRET":{"value":null,"isSecret":true},"TF_VAR_OPTUMID_CLIENTID":{"value":null,"isSecret":true}},"variableGroups":[5],"environments":[{"id":3,"name":"Dev","rank":1,"owner":{"id":"7bcd21e1-51fa-4c24-8c4e-9a734be6d82f","displayName":"mhedber","uniqueName":"MS\\mhedber","url":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_apis/Identities/7bcd21e1-51fa-4c24-8c4e-9a734be6d82f","imageUrl":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/_api/_common/identityImage?id=7bcd21e1-51fa-4c24-8c4e-9a734be6d82f"},"variables":{"configEnvironment":{"value":"cloudNonprod"}},"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":7}]},"deployStep":{"tasks":[],"id":8},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":9}]},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"timeoutInMinutes":0,"queueId":46,"demands":["Agent.Name -equals $(BuildAgent)"],"enableAccessToken":false},"rank":1,"phaseType":1,"name":"Run on agent","workflowTasks":[{"taskId":"bdca7ba1-a4bb-4626-882b-a8de1c2a7811","version":"1.*","name":"Task group: UR Advisor: Remove Other Enviroments' Files $(System.DefaultWorkingDirectory)/UR Advisor/SolutionItems/FileRemoval","enabled":true,"alwaysRun":true,"continueOnError":true,"timeoutInMinutes":0,"definitionType":"metaTask","inputs":{"FileRemovalScriptPath":"$(System.DefaultWorkingDirectory)/UR Advisor/SolutionItems/FileRemoval","environment":"$(configEnvironment)","ArchivePath":"$(System.DefaultWorkingDirectory)/$(project_name)/drop/$(project_name).zip"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Initialize Terraform Workspace","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"scriptType":"filePath","scriptName":"$(DeploymentScriptSource)/initializeWorkspace.ps1","arguments":"$(LocalTerraformWorkspace)","inlineScript":"# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"","workingFolder":"","failOnStandardError":"true"}},{"taskId":"5bfb729a-a7c8-4a78-a7c3-8d717bb7c13c","version":"2.*","name":"Copy Files to: $(LocalTerraformWorkspace)","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"SourceFolder":"$(DeploymentScriptSource)","Contents":"**\\*","TargetFolder":"$(LocalTerraformWorkspace)","CleanTargetFolder":"true","OverWrite":"false","flattenFolders":"false"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Create Terraform Plan","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"scriptType":"filePath","scriptName":"$(LocalTerraformWorkspace)/terraformCreatePlan.ps1","arguments":"-TF_VAR_SQL_PASSWORD $(TF_VAR_SQL_PASSWORD) -ARM_CLIENT_SECRET $(ARM_CLIENT_SECRET) -TF_VAR_OPTUMID_CLIENTSECRET $(TF_VAR_OPTUMID_CLIENTSECRET) -TF_VAR_OPTUMID_CLIENTID $(TF_VAR_OPTUMID_CLIENTID) -ARM_SUBSCRIPTION_ID $(ARM_SUBSCRIPTION_ID) -ARM_TENANT_ID $(ARM_TENANT_ID) -ARM_CLIENT_ID $(ARM_CLIENT_ID)","inlineScript":"# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"","workingFolder":"$(LocalTerraformWorkspace)","failOnStandardError":"true"}}]},{"rank":2,"phaseType":2,"name":"Run on server","workflowTasks":[{"taskId":"bcb64569-d51a-4af0-9c01-ea5d05b3b622","version":"8.*","name":"Verify Plan","enabled":false,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"instructions":"Please review the Terraform Plan as documented in the log of the release in TFS.","emailRecipients":"[\"7bcd21e1-51fa-4c24-8c4e-9a734be6d82f\"]","onTimeout":"reject"}}]},{"deploymentInput":{"parallelExecution":{"parallelExecutionType":"none"},"skipArtifactsDownload":false,"timeoutInMinutes":0,"queueId":46,"demands":["Agent.Name -equals $(BuildAgent)"],"enableAccessToken":false},"rank":3,"phaseType":1,"name":"Run on agent","workflowTasks":[{"taskId":"bdca7ba1-a4bb-4626-882b-a8de1c2a7811","version":"1.*","name":"Task group: UR Advisor: Remove Other Enviroments' Files $(System.DefaultWorkingDirectory)/UR Advisor/SolutionItems/FileRemoval","enabled":true,"alwaysRun":true,"continueOnError":true,"timeoutInMinutes":0,"definitionType":"metaTask","inputs":{"FileRemovalScriptPath":"$(System.DefaultWorkingDirectory)/UR Advisor/SolutionItems/FileRemoval","environment":"$(configEnvironment)","ArchivePath":"$(System.DefaultWorkingDirectory)/$(project_name)/drop/$(project_name).zip"}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Apply Terraform Plan","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"scriptType":"filePath","scriptName":"$(LocalTerraformWorkspace)/terraformApplyPlan.ps1","arguments":"-ARM_CLIENT_SECRET $(ARM_CLIENT_SECRET)","inlineScript":"# You can write your powershell scripts inline here. \n# You can also pass predefined and custom variables to this scripts using arguments\n\n Write-Host \"Hello World\"","workingFolder":"$(LocalTerraformWorkspace)","failOnStandardError":"true"}},{"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"3.*","name":"Azure App Service Deploy: $(applicationservicename)","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"ConnectedServiceName":"7b8f4040-4bc4-4a73-8f85-1b9fd0946a87","WebAppName":"$(applicationservicename)","ServerfarmId":"invalidServerfarmId","WebAppKind":"app","DockerNamespace":"","DockerRepository":"","DockerImageTag":"","StartupCommand":"","DeployToSlotFlag":"false","ResourceGroupName":"","SlotName":"","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/$(project_name)/drop/$(project_name).zip","WebAppUri":"","ScriptType":"","InlineScript":":: You can provide your deployment commands here. One command per line.","ScriptPath":"","TakeAppOfflineFlag":"true","UseWebDeploy":"true","SetParametersFile":"","RemoveAdditionalFilesFlag":"true","ExcludeFilesFromAppDataFlag":"false","AdditionalArguments":"","RenameFilesFlag":"false","GenerateWebConfig":"false","WebConfigParameters":"","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":"","AppSettings":""}},{"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Access site by host name","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(applicationhostname)","inlineScript":"Param(\n    [String]$applicationhostname\n)\nwrite-host Invoking https://$applicationhostname/\nInvoke-WebRequest -Uri https://$applicationhostname/","workingFolder":"","failOnStandardError":"true"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"retentionPolicy":{"daysToKeep":30,"releasesToKeep":25,"retainBuild":true}}],"artifacts":[{"sourceId":"0c80a520-fffc-468c-8b53-ccf5ac2355e9:406","type":"Build","alias":"UR Advisor","definitionReference":{"artifactSourceDefinitionUrl":{"id":"http://patfs01a.ehr.com:8080/tfs/_permalink/_build/index?collectionId=4c11d113-4835-4949-ac79-bcf177140056&projectId=0c80a520-fffc-468c-8b53-ccf5ac2355e9&definitionId=406","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"406","name":"UR Advisor"},"project":{"id":"0c80a520-fffc-468c-8b53-ccf5ac2355e9","name":"CommercialSoftware"}},"isPrimary":true}],"triggers":[],"releaseNameFormat":"Release-$(rev:r)","url":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/0c80a520-fffc-468c-8b53-ccf5ac2355e9/_apis/Release/definitions/3","_links":{"self":{"href":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/0c80a520-fffc-468c-8b53-ccf5ac2355e9/_apis/Release/definitions/3"},"web":{"href":"http://patfs01a.ehr.com:8080/tfs/EHRCollection/0c80a520-fffc-468c-8b53-ccf5ac2355e9/_release?definitionId=3"}},"tags":[],"properties":{}}